<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DennisFX - Deriv Trading</title>
    <script src="https://cdn.jsdelivr.net/npm/@deriv/deriv-api/dist/deriv-api.min.js"></script>
    <style>
        body { margin: 0; font-family: Arial; background: #0d1117; color: white; min-height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .card { background: #161b22; padding: 40px; border-radius: 12px; max-width: 500px; text-align: center; border: 1px solid #30363d; }
        h1 { color: #ff4d4d; }
        .btn { background: #ff4d4d; color: white; padding: 15px 30px; border: none; border-radius: 8px; font-size: 18px; cursor: pointer; margin: 15px; }
        .btn:hover { background: #e63939; }
        #status { margin: 20px 0; font-size: 18px; }
        #balance { font-size: 32px; color: #4caf50; margin: 20px 0; }
    </style>
</head>
<body>
    <div class="card">
        <h1>DennisFX</h1>
        <p>Connect your Deriv account to trade</p>

        <button class="btn" onclick="connect()">Connect Deriv Account</button>
        <p id="status">Status: Not connected</p>
        <p id="balance">Balance: â€”</p>
    </div>

    <script>
        const appId = 126400;  // Your new App ID

        function connect() {
            document.getElementById('status').innerText = 'Redirecting to Deriv...';

            const redirectUri = window.location.origin + '/callback';
            const url = https://oauth.deriv.com/oauth2/authorize?app_id=\( {appId}&scope=read trade trading_information payments&redirect_uri= \){encodeURIComponent(redirectUri)};

            window.location.href = url;
        }

        // Handle token on load
        window.onload = () => {
            const params = new URLSearchParams(window.location.search);
            const token = params.get('token1');

            if (token) {
                localStorage.setItem('deriv_token', token);
                document.getElementById('status').innerText = 'Connected! Loading balance...';

                const api = new DerivAPI({ authorize: token });
                api.balance().subscribe(b => {
                    document.getElementById('balance').innerText = Balance: ${b.balance} ${b.currency};
                    document.getElementById('status').innerText = 'Connected successfully';
                }, err => {
                    document.getElementById('status').innerText = 'Error: ' + err.message;
                });
            } else {
                // Optional: use saved token from previous connect
                const savedToken = localStorage.getItem('deriv_token');
                if (savedToken) {
                    document.getElementById('status').innerText = 'Using saved connection...';
                    const api = new DerivAPI({ authorize: savedToken });
                    api.balance().subscribe(b => {
                        document.getElementById('balance').innerText = Balance: ${b.balance} ${b.currency};
                        document.getElementById('status').innerText = 'Connected (saved)';
                    });
                }
            }
        };
    </script>
</body>
</html>
